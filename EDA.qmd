---
title: "EDA"
author: "Kim Costello"
format: html
editor: visual
---

```{r}
library(readr)    #to read in CSV file
library(psych)    #to describe the data
library(dplyr)    #to clean the data
library(janitor)  #to clean names
library(ggplot2)  #for plots
library(ggeasy)   #for plots
```

## Diabetes Health Indicators Dataset

#### Intro:

The Diabetes Health Indicators Dataset is a collection of information from telephone surveys that are conducted annually by the CDC. The survey collects responses from over 400,000 Americans on health-related risk behaviors. The data provided and explored within this document is from the year 2015.

Numerous variables are provided in the dataset. However, we will focus on the variables listed below to explore, in relation to our response variable, Diabetes Status. This response variable is provided as a binary variable (diabetes_binary). A 0 value indicates the individual does not have diabetes and a 1 value indicates the individual has diabetes or pre-diabetes.

Other variables of interest, and their possible values (where applicable):

-   HighBP: 0 indicates no high blood pressure, 1 indicates high blood pressure

-   HighChol: 0 indicates no high cholesterol, 1 indicates high cholesterol

-   BMI: Body Mass Index, this is a measure of weight relative to height

-   Smoker: 0 indicates individual has smoked at least 100 cigarettes in their life, 1 indicates they have not

-   Stroke: 0 indicates individual has not had a stroke, 1 indicates they have

-   HeartDiseaseorAttack: 0 indicates individual has not had coronary heart disease or myocardial infarction, 1 indicates they have

-   PhysActivity: 0 indicates individual has not had any physical activity (outside of job) in the past 30 days, 1 indicates they have

-   HvyAlcoholConsump: 0 indicates individual is not a heavy drinker, 1 indicates they are (greater than or equal to 14 drinks for men and 7 drinks for women per week)

-   AnyHealthcare: 0 indicates individual does not have health care coverage, 1 indicates they do

-   GenHlth: general health level, 1 is excellent, 2 is very good, 3 is good, 4 is fair, and 5 is poor

-   MentHlth: number of days of poor mental health (1-30 days)

-   PhysHlth: number of days of physical illness or injury in the past 30 days

-   Sex: Female or Male

-   Age: Age level category, 1 = 18-24, 2 = 25-29, 3 = 30-34, 4 = 35-39, 5 = 40-44, 6 = 45-49, 7 = 50-54, 8 = 55-59, 9 = 60-64, 10 = 65-69, 11 = 70-74, 12 = 75-79, 13 =80 or older

First, exploratory data analysis will be conducted to get to know the data. We want to understand how the data is stored, determine the rate of missing values, and clean up the data as needed. We want to investigate the distributions with summaries and graphs to gain some insights into the data and relationships between variables. 

Then, we will want to determine which predictive model, a classification tree or a random forest model, is the best model to use to make a prediction for the response variable, Diabetes Status, given specific predictor variables. 


#### The Data:

The data can be found on kaggle.com and is provided in a CSV file.
```{r}
#read in data
diabetes_data <- read_csv("diabetes_binary_health_indicators_BRFSS2015.csv")
```

Let's determine if there are any missing values in the dataset.

```{r}
colSums(is.na(diabetes_data))
```

There are no missing values in the dataset.

The following contains the structure of the data set, so we can see the different variables and how they are being stored.

```{r}
str(diabetes_data)
```
All of the variables are being stored as numeric. However, most of these variables should be categorical - they have different levels or categories, and you cannot do math on the values (the results would not make sense). Therefore, we will want to convert them to factors.

```{r}
diabetes_data <- diabetes_data |>
  mutate(
    Diabetes_binary = factor(Diabetes_binary, 
                             levels = c(0, 1),
                             labels = c("No diabetes",
                                        "Prediabetes/Diabetes")),
    HighBP = factor(HighBP,
                    levels = c(0, 1),
                    labels = c("Not high BP", "High BP")),
    HighChol = factor(HighChol,
                      levels = c(0, 1),
                      labels = c("Not high cholesterol", "High cholesterol")), 
    Smoker = factor(Smoker,
                      levels = c(0, 1),
                      labels = c("Non-smoker", "Smoker")),
    Stroke = factor(Stroke,
                      levels = c(0, 1),
                      labels = c("No stroke", "Stroke")),
    HeartDiseaseorAttack = factor(HeartDiseaseorAttack,
                                  levels = c(0, 1),
                                  labels = c("No heart disease/attack", 
                                             "Heart disease/attack")),
    PhysActivity = factor(PhysActivity,
                      levels = c(0, 1),
                      labels = c("No physical activity", "Physical activity")),
    HvyAlcoholConsump = factor(HvyAlcoholConsump,
                      levels = c(0, 1),
                      labels = c("Not a heavy drinker", "Heavy drinker")),
    AnyHealthcare = factor(AnyHealthcare,
                      levels = c(0, 1),
                      labels = c("No healthcare", "Healthcare")),
    GenHlth = factor(GenHlth,
                     levels = c(1, 2, 3, 4, 5),
                     labels = c("Excellent", "Very good", 
                                "Good", "Fair", "Poor")),
    Sex = factor(Sex,
                 levels = c(0, 1),
                 labels = c("Female", "Male")),
    Age = factor(Age,
                 levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13),
                 labels = c("18-24", "25-29", "30-34", "35-39", "40-44",
                            "45-49", "50-54", "55-59", "60-64", "65-69",
                            "70-74", "75-79", "80 or older"))
    ) |>
  select(-CholCheck, -NoDocbcCost, -Fruits, -Veggies, -Income, -Education, 
         -DiffWalk) |> #removing variables that we won't use
  clean_names("snake")     #cleaning names for easier coding


```


#### Data Summaries and Plots

Let's explore the data set to gain some insights into the distributions and relationships. 

The following is the mean, median, minimum, maximum, and interquartile range for the numeric variables, grouped by diabetes status. 
```{r}
diabetes_data |>
  group_by(diabetes_binary) |>
  summarize(across(where(is.numeric), 
                   list("mean" = mean, 
                        "median" = median, 
                        "min" = min, 
                        "max" = max,
                        "IQR" = IQR), 
                   .names = "{.fn}_{.col}"))
```
As expected, the mean BMI for individuals with diabetes/prediabetes is higher ,at 31, than those without diabetes at 27. Over 30 is considered to be obese, which obesity has been considered a major risk factor for heart disease. The average number of days of physical illness or injury in the past 30 days is also much higher for those with (pre)diabetes at 8 days verses those without at 3.6 days.  

The following contingency table will give the number of individuals with/without diabetes based on their age group. 
```{r}
table(diabetes_data$age, diabetes_data$diabetes_binary)
```
The highest number of individuals with diabetes/prediabetes occurs in the 65-69 age group, and the lowest is the youngest age group, 18-24. 

The following contingency table will give us the number of individuals with/without diabetes by sex and by whether they've had heart disease or a heart attack. 
```{r}
table(diabetes_data$heart_diseaseor_attack, 
      diabetes_data$sex, 
      diabetes_data$diabetes_binary)
```
It may be surprising to see that the number of individuals who have heart disease or who have had a heart attack is higher for those without diabetes (for both sexes) than those who do have diabetes/prediabetes. 


Let's view some relationships visually. 

The following barplot displays the number of individuals with/without diabetes according to smoker status and whether or not they've had heart disease or heart attack. 
```{r}
g <- ggplot(data = diabetes_data)

g + geom_bar(aes(x = diabetes_binary, fill = smoker), position = "dodge") +
  labs(x = "Diabetes Status", 
       y = "Count",
       title = "Number of Individuals per Diabetes Status", 
       fill = "Smoker Status") +
  easy_center_title() +
  facet_wrap(~ heart_diseaseor_attack)
```
For those who have had a heart attack/disease, more individuals were smokers than non-smokers, but it did not seem to be an indicator of diabetes (there were more smokers and individuals with a heart attack/disease that did not have diabetes). For those who have not had a heart attack or heart disease, smoking status was almost equal (non-smoker vs smoker) for those with diabetes. 

The following violin plot will take a look at BMI related to Sex and Diabetes Status. 
```{r}
ggplot(diabetes_data, aes(x = sex, y = bmi, fill = diabetes_binary)) +
  geom_violin() +
  labs(x = "Sex", 
       y = "BMI",
       title = "BMI by Sex and Diabetes Status",
       fill = "Diabetes Status") +
  easy_center_title() +
  scale_fill_manual(values = c("lightpink",
                               "lightblue"))
```
The BMI for both sexes is higher for those with diabetes/prediabetes. 

The following density plot also gives the relationship between BMI and diabetes status. 
```{r}
g + geom_density(aes(x = bmi, fill = diabetes_binary), alpha = 0.5) +
  labs(x = "BMI", 
       y = "Density",
       title = "BMI by Diabetes Status", 
       fill = "Diabetes Status") +
  easy_center_title() 
```
Just as the violin plot above showed, those with prediabetes/diabetes tend to have a higher BMI. 

The following bloxplot will also look at BMI and diabetes status, by those with/without heart disease or heart attack. 
```{r}
ggplot(diabetes_data, aes(x = diabetes_binary, y = bmi, fill = heart_diseaseor_attack)) +
  geom_boxplot() +
  labs(x = "Diabetes Status", 
       y = "BMI",
       title = "BMI by Sex and Diabetes Status",
       fill = "Heart Disease/Attack Status") +
  easy_center_title() +
  scale_fill_manual(values = c("lightpink",
                               "lightblue"))
```
As the other graphs have shown, the mean BMI is greater for those with diabetes/prediabetes. However, the mean BMI is approximately the same (in both diabetes status groups) between those with heart disease/attack and those without. 


The following density plot show the BMI by diabetes status and physical activity level.  
```{r}
g + geom_density(aes(x = bmi, fill = diabetes_binary), alpha = 0.5) +
  labs(x = "BMI", 
       y = "Density",
       title = "BMI by Diabetes Status",
       subtitle = "compared to physical activity level",
       fill = "Diabetes Status") +
  easy_center_title() +
  theme(plot.subtitle = element_text(hjust = 0.5)) +
  facet_wrap(~ phys_activity)
```
The density plot shifts slightly right for those who have not had physical activity (outside of work) in the past 30 days, which means more of the individuals that have not had physical activity have higher BMI's. 

The following barplot shows general health based on diabetes status. 
```{r}
g + geom_bar(aes(x = gen_hlth, fill = diabetes_binary), position = "dodge") +
  labs(x = "General Health Condition", 
       y = "Count",
       title = "Diabetes Status based on General Health", 
       fill = "Diabetes Status") +
  easy_center_title()
```
As health condition worsens, the number of those without diabetes decreases. 
It is surprising to see that the greatest number of individuals with prediabetes/diabetes have "good" health. 

Now that we've seen some relationships in the data, let's take a look at some models that we can use to predict diabetes status. 



